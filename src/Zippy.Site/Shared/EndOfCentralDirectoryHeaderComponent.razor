@using Zippy.Site.Extensions;
@using Zippy.Site.Shared.Input;


<div class="accordion-item">
    <h2 class="accordion-header" id="@("header_" + _htmlId)">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse"
                data-bs-target="@("#" + _htmlId)"
                aria-expanded="false"
                aria-controls="@_htmlId">
            @if (EndOfCentralDirectoryHeader != null)
            {
                @:End of central directory record
            }
        </button>
    </h2>
    <div id="@_htmlId" class="accordion-collapse collapse" aria-labelledby="@("header_" + _htmlId)">
        <div class="accordion-body">
            @if (EndOfCentralDirectoryHeader != null)
            {
                <table class="table table-condensed table-striped table-hover table-bordered">
                    <thead>
                        <tr class="table-light">
                            <th>Field</th>
                            <th>Raw value</th>
                            <th>Display value</th>
                            <th>Explanation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Signature</td>
                            <td>@EndOfCentralDirectoryHeader.Signature.ToHexString()</td>
                            <td></td>
                            <td>Should always be 0x06054b50</td>
                        </tr>
                        <tr>
                            <td>Number of this disk</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.NumberOfThisDisk" /></td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.NumberOfThisDisk" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Disk where central directory starts</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.NumberOfDiskWithStartOfCentralDirectory" /></td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.NumberOfDiskWithStartOfCentralDirectory" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Total number of entries in the central directory on this disk</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.NumberOfEntriesInCentralDirectoryOnThisDisk" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Total number of entries in central directory</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.TotalNumberOfEntriesInCentralDirectory" /></td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.TotalNumberOfEntriesInCentralDirectory" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Size of central directory</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.SizeOfCentralDirectory" /></td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.SizeOfCentralDirectory" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td>0xffffffff for ZIP64</td>
                        </tr>
                        <tr>
                            <td>Offset of start of central directory, relative to start of archive</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.OffsetOfCentralDirectory" /></td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.OffsetOfCentralDirectory" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td>0xffffffff for ZIP64</td>
                        </tr>
                        <tr>
                            <td>Comment length</td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.ZipFileCommentLength" /></td>
                            <td><NumericInput @bind-Value="EndOfCentralDirectoryHeader.ZipFileCommentLength" DisplayMode="NumericDisplayMode.Decimal" /></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Comment</td>
                            <td colspan="3"><TextInput @bind-Value="EndOfCentralDirectoryHeader.ZipFileComment" /></td>
                        </tr>
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>

@code {
    private string _htmlId = $"cdh-{Guid.NewGuid()}";

    [Parameter]
    public EndOfCentralDirectoryHeader? EndOfCentralDirectoryHeader { get; set; }
}
